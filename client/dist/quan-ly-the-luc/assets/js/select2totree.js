!function(e){e.fn.select2ToTree=function(l){var n=e.extend({},l);n.treeData&&function(a,l){function n(e,t){for(var a=e,l=0;l<t.length;l++){var n=t[l];if(!a[n])return"MISSING";a=a[n]}return a}(function s(r,d,o){var p,i;a.labelFld&&a.labelFld.split(".").length>1&&(p=a.labelFld.split(".")),a.valFld&&a.valFld.split(".").length>1&&(i=a.valFld.split("."));for(var u=0;u<r.length;u++){var c=r[u]||{},v=e("<option></option>");v.text(p?n(c,p):c[a.labelFld||"text"]),v.val(i?n(c,i):c[a.valFld||"id"]),c[a.selFld||"selected"]&&"true"===String(c[a.selFld||"selected"])&&v.prop("selected",c[a.selFld||"selected"]),""===v.val()&&(v.prop("disabled",!0),v.val("autoUniqueVal_"+t++)),v.addClass("l"+d),o&&v.attr("data-pup",o),l.append(v);var f=c[a.incFld||"inc"];f&&f.length>0&&(v.addClass("non-leaf"),s(f,d+1,v.val()))}})(a.dataArr,1,""),a.dftVal&&l.val(a.dftVal)}(n.treeData,this),n._templateResult=n.templateResult,n.templateResult=function(t,a){var l=t.text;"function"==typeof n._templateResult&&(l=n._templateResult(t,a));var s=e("<span class='item-label'></span>").append(l);if(t.element){var r=t.element;if(a.setAttribute("data-val",r.value),r.className&&(a.className+=" "+r.className),r.getAttribute("data-pup")&&a.setAttribute("data-pup",r.getAttribute("data-pup")),e(a).hasClass("non-leaf"))return e.merge(e('<span class="expand-collapse" onmouseup="expColMouseupHandler(event);"></span>'),s)}return s},window.expColMouseupHandler=function(t){var l;e((l=t.target||t.srcElement).parentNode).toggleClass("opened"),a(l.parentNode),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault?t.preventDefault():t.returnValue=!1};var s=this.select2(n);function r(t){var a=s.data("select2");e(this).val().trim().length>0?a.$dropdown.addClass("searching-result"):a.$dropdown.removeClass("searching-result")}return s.on("select2:open",function(e){var t=s.data("select2");t.$dropdown.addClass("s2-to-tree"),t.$dropdown.removeClass("searching-result");var a=t.$dropdown.find(".select2-search__field").add(t.$container.find(".select2-search__field"));a.off("input",r),a.on("input",r)}),s};var t=1;function a(t){var l=t,n=e(t).parent(".select2-results__options"),s=!0;do{var r=(e(l).attr("data-pup")||"").replace(/'/g,"\\'");if(l=null,r){var d=n.find(".select2-results__option[data-val='"+r+"']");if(d.length>0){if(!d.eq(0).hasClass("opened")){e(t).removeClass("showme"),s=!1;break}l=d[0]}}}while(l);s&&e(t).addClass("showme");var o=(e(t).attr("data-val")||"").replace(/'/g,"\\'");n.find(".select2-results__option[data-pup='"+o+"']").each(function(){a(this)})}}(jQuery);