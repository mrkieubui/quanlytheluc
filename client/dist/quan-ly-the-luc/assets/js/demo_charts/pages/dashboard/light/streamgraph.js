var D3Streamgraph={init:function(){!function(){if("undefined"!=typeof d3){var t=document.getElementById("traffic-sources"),e=340;if(t){var a=d3.select(t),s={top:5,right:50,bottom:40,left:50},i=a.node().getBoundingClientRect().width-s.left-s.right,r=(e=e-s.top-s.bottom,a.append("div").attr("class","d3-tip e").style("display","none")),n=d3.time.format("%m/%d/%y %H:%M"),l=d3.time.format("%H:%M"),o=d3.time.scale().range([0,i]),d=d3.scale.linear().range([e,0]),c=d3.scale.ordinal().range(["#03A9F4","#29B6F6","#4FC3F7","#81D4FA","#B3E5FC","#E1F5FE"]),u=d3.svg.axis().scale(o).orient("bottom").ticks(d3.time.hours,4).innerTickSize(4).tickPadding(8).tickFormat(d3.time.format("%H:%M")),p=d3.svg.axis().scale(d).ticks(6).innerTickSize(4).outerTickSize(0).tickPadding(8).tickFormat(function(t){return t/1e3+"k"}),y=p,m=d3.svg.axis().scale(d).orient("left").ticks(6).tickPadding(8).tickFormat("").tickSize(-i,0,0),f=a.append("svg"),g=f.attr("width",i+s.left+s.right).attr("height",e+s.top+s.bottom).append("g").attr("transform","translate("+s.left+","+s.top+")"),h=d3.layout.stack().offset("silhouette").values(function(t){return t.values}).x(function(t){return t.date}).y(function(t){return t.value}),x=d3.nest().key(function(t){return t.key}),v=d3.svg.area().interpolate("cardinal").x(function(t){return o(t.date)}).y0(function(t){return d(t.y0)}).y1(function(t){return d(t.y0+t.y)});d3.csv("../../../../global_assets/demo_data/dashboard/traffic_sources.csv",function(f,k){k.forEach(function(t){t.date=n.parse(t.date),t.value=+t.value});var b=h(x.entries(k));o.domain(d3.extent(k,function(t,e){return t.date})),d.domain([0,d3.max(k,function(t){return t.y0+t.y})]),g.append("g").attr("class","d3-grid-dashed").call(m);var w=g.append("g").attr("class","streamgraph-layers-group"),A=w.selectAll(".streamgraph-layer").data(b).enter().append("path").attr("class","streamgraph-layer d3-slice-border").attr("d",function(t){return v(t.values)}).style("stroke-width",1).style("box-shadow","0 4px 8px rgba(0,0,0,0.5)").style("fill",function(t,e){return c(e)}),F=A.style("opacity",0).transition().duration(750).delay(function(t,e){return 50*e}).style("opacity",1);g.append("g").attr("class","d3-axis d3-axis-left").call(p.orient("left")),d3.select(g.selectAll(".d3-axis-left .tick text")[0][0]).style("visibility","hidden"),g.append("g").attr("class","d3-axis d3-axis-right").attr("transform","translate("+i+", 0)").call(y.orient("right")),d3.select(g.selectAll(".d3-axis-right .tick text")[0][0]).style("visibility","hidden"),g.append("g").attr("class","d3-axis d3-axis-horizontal").attr("transform","translate(0,"+e+")").call(u).selectAll(".d3-axis-subticks").data(o.ticks(d3.time.hours),function(t){return t}).enter().append("line").attr("class","d3-axis-subticks").attr("y1",0).attr("y2",4).attr("x1",o).attr("x2",o);var z=w.append("g").attr("class","hover-line"),E=z.append("line").attr("class","d3-crosshair-line").attr("y1",0).attr("y2",e).style("opacity",0),S=z.append("rect").attr("class","d3-crosshair-line").attr("x",2).attr("y",2).attr("width",6).attr("height",6).style("fill","#03A9F4").style("opacity",0);F.each("end",function(){A.on("mouseover",function(t,e){g.selectAll(".streamgraph-layer").transition().duration(250).style("opacity",function(t,a){return a!=e?.75:1})}).on("mousemove",function(t,e){mouse=d3.mouse(this),mousex=mouse[0],mousey=mouse[1],datearray=[];var a=o.invert(mousex);a=a.getHours();for(var s=t.values,i=0;i<s.length;i++)datearray[i]=s[i].date,datearray[i]=datearray[i].getHours();mousedate=datearray.indexOf(a),pro=t.values[mousedate].value,S.attr("x",mousex-3).attr("y",mousey-6).style("opacity",1),E.attr("x1",mousex).attr("x2",mousex).style("opacity",1),r.html('<ul class="list-unstyled mb-1 p-0"><li><div class="font-size-base my-1"><i class="icon-circle-left2"></i><span class="d-inline-block ml-2"></span>'+t.key+"</div></li><li>Visits: &nbsp;<span class='font-weight-semibold float-right'>"+pro+'</span></li><li>Time: &nbsp; <span class="font-weight-semibold float-right">'+l(t.values[mousedate].date)+"</span></li></ul>").style("display","block"),r.append("div").attr("class","d3-tip-arrow")}).on("mouseout",function(t,e){g.selectAll(".streamgraph-layer").transition().duration(250).style("opacity",1),S.style("opacity",0),r.style("display","none"),E.style("opacity",0)})}),a.on("mousemove",function(e,a){mouse=d3.mouse(this),mousex=mouse[0],mousey=mouse[1],r.style("top",mousey-$(".d3-tip").outerHeight()/2-2+"px"),mousex>=$(t).outerWidth()-$(".d3-tip").outerWidth()-s.right-60?r.style("left",mousex-$(".d3-tip").outerWidth()-30+"px").attr("class","d3-tip w"):r.style("left",mousex+30+"px").attr("class","d3-tip e")})}),window.addEventListener("resize",b);var k=document.querySelector(".sidebar-control");function b(){i=a.node().getBoundingClientRect().width-s.left-s.right,f.attr("width",i+s.left+s.right),g.attr("width",i+s.left+s.right),o.range([0,i]),g.selectAll(".d3-axis-horizontal").call(u),g.selectAll(".d3-axis-subticks").attr("x1",o).attr("x2",o),g.selectAll(".d3-grid-dashed").call(m.tickSize(-i,0,0)),g.selectAll(".d3-axis-right").attr("transform","translate("+i+", 0)"),g.selectAll(".streamgraph-layer").attr("d",function(t){return v(t.values)})}k&&k.addEventListener("click",b)}}else console.warn("Warning - d3.min.js is not loaded.")}()}};document.addEventListener("DOMContentLoaded",function(){D3Streamgraph.init()});