var D3Waterfall={init:function(){!function(){if("undefined"!=typeof d3){var t=document.getElementById("d3-waterfall"),e=400;if(t){var a=d3.select(t),n={top:5,right:10,bottom:100,left:50},r=a.node().getBoundingClientRect().width-n.left-n.right,l=(e=e-n.top-n.bottom,.3);function d(t){var e=t=Math.round(t);return Math.abs(t)>1e3&&(e=Math.round(t/1e3)+"K"),"$"+e}var i=d3.scale.ordinal().rangeRoundBands([0,r],l),o=d3.scale.linear().range([e,0]),s=d3.svg.axis().scale(i).orient("bottom"),c=d3.svg.axis().scale(o).orient("left").tickFormat(function(t){return d(t)}),f=a.append("svg"),u=f.attr("width",r+n.left+n.right).attr("height",e+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")");d3.csv("../../../../global_assets/demo_data/d3/other/waterfall.csv",function(t,a){a.forEach(function(t){t.value=+t.value});for(var n=0,r=0;r<a.length;r++)a[r].start=n,a[r].end=n+=a[r].value,a[r].class=a[r].value>=0?"positive":"negative";a.push({name:"Total",end:n,start:0,class:"total"}),i.domain(a.map(function(t){return t.name})),o.domain([0,d3.max(a,function(t){return t.end})]),u.append("g").attr("class","d3-axis d3-axis-horizontal").attr("transform","translate(0,"+e+")").call(s).selectAll("text").style("text-anchor","end").attr("dx","-15px").attr("dy","-6px").attr("transform",function(t){return"rotate(-90)"}),u.append("g").attr("class","d3-axis d3-axis-vertical").call(c);var l=u.selectAll(".d3-waterfall-bar").data(a).enter().append("g").attr("class",function(t){return"d3-waterfall-bar "+t.class}).attr("transform",function(t){return"translate("+i(t.name)+",0)"});l.append("rect").attr("y",function(t){return o(Math.max(t.start,t.end))}).attr("height",function(t){return Math.abs(o(t.start)-o(t.end))}).attr("width",i.rangeBand()),l.append("text").attr("x",i.rangeBand()/2).attr("y",function(t){return o(t.end)+5}).attr("dy",function(t){return("negative"==t.class?"-":"")+"1.5em"}).style("fill","#fff").style("text-anchor","middle").text(function(t){return d(t.end-t.start)}),l.filter(function(t){return"positive"==t.class}).select("rect").style("fill","#EF5350"),l.filter(function(t){return"negative"==t.class}).select("rect").style("fill","#66BB6A"),l.filter(function(t){return"total"==t.class}).select("rect").style("fill","#42A5F5"),l.filter(function(t){return"total"!=t.class}).append("line").attr("class","d3-waterfall-connector d3-line-connect").attr("x1",i.rangeBand()+5).attr("y1",function(t){return o(t.end)}).attr("x2",i.rangeBand()/.7-5).attr("y2",function(t){return o(t.end)}).style("stroke-dasharray",3)}),window.addEventListener("resize",h);var g=document.querySelector(".sidebar-control");function h(){r=a.node().getBoundingClientRect().width-n.left-n.right,f.attr("width",r+n.left+n.right),u.attr("width",r+n.left+n.right),i.rangeRoundBands([0,r],l),u.selectAll(".d3-axis-horizontal").call(s).selectAll("text").style("text-anchor","end").attr("dy","-6px"),u.selectAll(".d3-waterfall-bar").attr("transform",function(t){return"translate("+i(t.name)+",0)"}),u.selectAll(".d3-waterfall-bar rect").attr("width",i.rangeBand()),u.selectAll(".d3-waterfall-bar text").attr("x",i.rangeBand()/2),u.selectAll(".d3-waterfall-connector").attr("x1",i.rangeBand()+5).attr("x2",i.rangeBand()/.7-5)}g&&g.addEventListener("click",h)}}else console.warn("Warning - d3.min.js is not loaded.")}()}};document.addEventListener("DOMContentLoaded",function(){D3Waterfall.init()});