var D3AreaStacked={init:function(){!function(){if("undefined"!=typeof d3){var t=document.getElementById("d3-area-stacked"),e=400;if(t){var a=d3.select(t),n={top:5,right:10,bottom:20,left:40},r=a.node().getBoundingClientRect().width-n.left-n.right,d=(e=e-n.top-n.bottom-5,d3.time.format("%y-%b-%d").parse),l=d3.format(".0%"),i=d3.scale.category20(),o=d3.time.scale().range([0,r]),s=d3.scale.linear().range([e,0]),c=d3.svg.axis().scale(o).orient("bottom").ticks(6).tickFormat(d3.time.format("%b")),u=d3.svg.axis().scale(s).orient("left").tickFormat(l),f=d3.select(t).append("svg"),m=f.attr("width",r+n.left+n.right).attr("height",e+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),v=d3.svg.area().x(function(t){return o(t.date)}).y0(function(t){return s(t.y0)}).y1(function(t){return s(t.y0+t.y)}),g=d3.layout.stack().values(function(t){return t.values});d3.tsv("http://demo.interface.club/limitless/demo/Template/global_assets/demo_data/d3/lines/lines_stacked.tsv",function(t,a){a.forEach(function(t){t.date=d(t.date)}),i.domain(d3.keys(a[0]).filter(function(t){return"date"!==t}));var n=g(i.domain().map(function(t){return{name:t,values:a.map(function(e){return{date:e.date,y:e[t]/100}})}}));o.domain(d3.extent(a,function(t){return t.date}));var r=m.selectAll(".browser").data(n).enter().append("g").attr("class","browser");r.append("path").attr("class","d3-area").attr("d",function(t){return v(t.values)}).style("fill",function(t){return i(t.name)}),r.append("text").datum(function(t){return{name:t.name,value:t.values[t.values.length-1]}}).attr("transform",function(t){return"translate("+o(t.value.date)+","+s(t.value.y0+t.value.y/2)+")"}).attr("class","d3-browsers").attr("x",-15).attr("dy",".35em").style("fill","#fff").style("text-anchor","end").text(function(t){return t.name}),m.append("g").attr("class","d3-axis d3-axis-horizontal").attr("transform","translate(0,"+e+")").call(c),m.append("g").attr("class","d3-axis d3-axis-vertical").call(u)}),window.addEventListener("resize",y);var p=document.querySelector(".sidebar-control");function y(){r=a.node().getBoundingClientRect().width-n.left-n.right,f.attr("width",r+n.left+n.right),m.attr("width",r+n.left+n.right),o.range([0,r]),m.selectAll(".d3-axis-horizontal").call(c),m.selectAll(".d3-area").attr("d",function(t){return v(t.values)}),m.selectAll(".d3-browsers").attr("transform",function(t){return"translate("+o(t.value.date)+","+s(t.value.y0+t.value.y/2)+")"})}p&&p.addEventListener("click",y)}}else console.warn("Warning - d3.min.js is not loaded.")}()}};document.addEventListener("DOMContentLoaded",function(){D3AreaStacked.init()});