var D3TreeBracket=function(){var t=function(){if("undefined"!=typeof d3){var t=document.getElementById("d3-tree-bracket"),e=600;if(t){var n,r=d3.select(t),i={top:0,right:0,bottom:0,left:0},a=r.node().getBoundingClientRect().width-i.left-i.right,l=a/2,o=(e=e-i.top-i.bottom-5,0),c=500,s="#2196F3",d=r.append("svg"),u=d.attr("width",a+i.left+i.right).attr("height",e+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),f=d3.behavior.zoom().scaleExtent([1,2]).on("zoom",function(){u.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")});d.call(f);var h=d3.layout.tree().size([e,a]),g=(d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),function(t,e){var n=y(t.source),r=y(t.target),i=(r.y-n.y)/2;return t.isRight&&(i=-i),"M"+n.y+","+n.x+"H"+(n.y+i)+"V"+r.x+"H"+r.y}),y=function(t){var e=t.y;return t.isRight||(e=l-(e=t.y-l)),{x:t.x,y:e}},v=function(t,e){var n=0,r=t.children?t.children.length:0;for((e=e||[]).push(t);n<r;n++)v(t.children[n],e);return e};function x(t){var e=v(t);e.forEach(function(t){t.y=180*t.depth+l});var n=u.selectAll("g.node").data(e,function(t){return t.id||(t.id=++o)});e.forEach(function(t){var e=y(t);t.x0=e.x,t.y0=e.y});var f=n.enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+t.y0+","+t.x0+")"}).on("click",function(e){e.children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null),x(t)});f.append("circle").attr("r",1e-6).attr("class","d3-line-circle").style("stroke",s).style("stroke-width",1.5).style("cursor","pointer").style("fill",function(t){return t._children&&s}),f.append("text").attr("class","d3-text").attr("dy",function(t){return t.isRight?18:-12}).attr("text-anchor","middle").text(function(t){return t.name}).style("font-size",12).style("fill-opacity",1e-6);var m=n.transition().duration(c).attr("transform",function(t){return p=y(t),"translate("+p.y+","+p.x+")"});m.select("circle").attr("r",4.5).style("fill",function(t){return t._children&&s}),m.select("text").style("fill-opacity",1);var w=n.exit().transition().duration(c).attr("transform",function(e){return p=y(e.parent||t),"translate("+p.y+","+p.x+")"}).remove();w.select("circle").attr("r",1e-6),w.select("text").style("fill-opacity",1e-6);var k=u.selectAll("path.link").data(h.links(e),function(t){return t.target.id});k.enter().insert("path","g").attr("class","link d3-line-connect").style("stroke-width",1.5).attr("d",function(e){var n={x:t.x0,y:t.y0};return g({source:n,target:n})}),k.transition().duration(c).attr("d",g),k.exit().transition().duration(c).attr("d",function(e){var n=y(e.source||t);return e.source.isRight?n.y-=l-(e.target.y-e.source.y):n.y+=l-(e.target.y-e.source.y),g({source:n,target:n})}).remove(),window.addEventListener("resize",b);var R=document.querySelector(".sidebar-control");function b(){a=r.node().getBoundingClientRect().width-i.left-i.right,d.attr("width",a+i.left+i.right),u.attr("width",a+i.left+i.right)}R&&R.addEventListener("click",b)}d3.json("../../../../global_assets/demo_data/d3/tree/tree_bracket.json",function(t){(n=t).x0=e/2,n.y0=a/2;var r=d3.layout.tree().size([e,l]).children(function(t){return t.winners}),i=d3.layout.tree().size([e,l]).children(function(t){return t.challengers});r.nodes(n),i.nodes(n);var o=function(t){t.children=function(t){var e=[];if(t.winners)for(var n=0;n<t.winners.length;n++)t.winners[n].isRight=!1,t.winners[n].parent=t,e.push(t.winners[n]);if(t.challengers)for(n=0;n<t.challengers.length;n++)t.challengers[n].isRight=!0,t.challengers[n].parent=t,e.push(t.challengers[n]);return e.length?e:null}(t),t.children&&t.children.forEach(o)};o(n),n.isRight=!1,x(n)})}}else console.warn("Warning - d3.min.js is not loaded.")};return{init:function(){t()}}}();document.addEventListener("DOMContentLoaded",function(){D3TreeBracket.init()});