!function(t){"use strict";function r(){for(var t,r=d3.select(this),n=r.datum(),e=n.radius,a=n.label.split(/\s+/).reverse(),i=(n.label.length+a.length)/3,s=a.pop(),o=[s],u=0,c=r.text(null).append("tspan").text(s);s=a.pop();)o.push(s),t=o.join(" "),c.text(t),t.length>i&&c.node().getComputedTextLength()>e&&(o.pop(),c.text(o.join(" ")),o=[s],c=r.append("tspan").text(s),u++);var l=.35-1.1*u/2,f=Math.floor(n.textCenter.x),h=Math.floor(n.textCenter.y);r.selectAll("tspan").attr("x",f).attr("y",h).attr("dy",function(t,r){return l+1.1*r+"em"})}function n(t,r){for(var n=new Array(t[1].length||0),e=0;e<n.length;++e)n[e]=t[0]*t[1][e]+r[0]*r[1][e];return n}function e(r,n,e,a){for(var i=[],s=0;s<r.length;++s)i.push({x:0,y:0,count:0});for(s=0;s<32;++s)for(var o=s*n/32,u=0;u<32;++u){for(var c={x:o,y:u*e/32},l=[],f=0;f<r.length;++f)t.distance(c,r[f])<=r[f].radius&&l.push(f);1==l.length&&((h=i[l[0]]).x+=c.x,h.y+=c.y,h.count+=1)}for(s=0;s<r.length;++s){var h;r[s].textCenter=(h=i[s]).count?{x:h.x/h.count,y:h.y/h.count}:{x:r[s].x,y:r[s].y}}}t.venn=function(r,n,e){(e=e||{}).maxIterations=e.maxIterations||500;var a=e.lossFunction||t.lossFunction;r=(e.layoutFunction||t.greedyLayout)(r,n);for(var i=new Array(2*r.length),s=0;s<r.length;++s)i[2*s]=r[s].x,i[2*s+1]=r[s].y;var o=t.fmin(function(t){for(var e=new Array(r.length),i=0;i<r.length;++i)e[i]={x:t[2*i],y:t[2*i+1],radius:r[i].radius,size:r[i].size};return a(e,n)},i,e).solution;for(s=0;s<r.length;++s)r[s].x=o[2*s],r[s].y=o[2*s+1];return r},t.distanceFromIntersectArea=function(r,n,e){return Math.min(r,n)*Math.min(r,n)*Math.PI<=e?Math.abs(r-n):t.bisect(function(a){return t.circleOverlap(r,n,a)-e},0,r+n)},t.getDistanceMatrix=function(r,n){for(var e=[],a=0;a<r.length;++a){e.push([]);for(var i=0;i<r.length;++i)e[a].push(0)}for(a=0;a<n.length;++a){var s=n[a];if(2===s.sets.length){var o=s.sets[0],u=s.sets[1],c=Math.sqrt(r[o].size/Math.PI),l=Math.sqrt(r[u].size/Math.PI),f=t.distanceFromIntersectArea(c,l,s.size);e[o][u]=e[u][o]=f}}return e},t.greedyLayout=function(r,n){for(var e={},a=0;a<r.length;++a)e[a]=[],r[a].radius=Math.sqrt(r[a].size/Math.PI),r[a].x=r[a].y=0;for(a=0;a<n.length;++a){var i=n[a];if(2===i.sets.length){var s=null==i.weight?1:i.weight,o=i.sets[0],u=i.sets[1];e[o].push({set:u,size:i.size,weight:s}),e[u].push({set:o,size:i.size,weight:s})}}var c=[];for(var l in e)if(e.hasOwnProperty(l)){var f=0;for(a=0;a<e[l].length;++a)f+=e[l][a].size*e[l][a].weight;c.push({set:l,size:f})}function h(t,r){return r.size-t.size}c.sort(h);var x={};function y(t){return t.set in x}function d(t,n){r[n].x=t.x,r[n].y=t.y,x[n]=!0}d({x:0,y:0},c[0].set);var g=t.getDistanceMatrix(r,n);for(a=1;a<c.length;++a){var v=c[a].set,p=e[v].filter(y);if(l=r[v],p.sort(h),0===p.length)throw"Need overlap information for set "+JSON.stringify(l);for(var M=[],m=0;m<p.length;++m){var I=r[p[m].set],w=g[v][p[m].set];M.push({x:I.x+w,y:I.y}),M.push({x:I.x-w,y:I.y}),M.push({y:I.y+w,x:I.x}),M.push({y:I.y-w,x:I.x});for(var A=m+1;A<p.length;++A)for(var z=r[p[A].set],C=t.circleCircleIntersection({x:I.x,y:I.y,radius:w},{x:z.x,y:z.y,radius:g[v][p[A].set]}),b=0;b<C.length;++b)M.push(C[b])}var P=1e50,D=M[0];for(m=0;m<M.length;++m){r[v].x=M[m].x,r[v].y=M[m].y;var q=t.lossFunction(r,n);q<P&&(P=q,D=M[m])}d(D,v)}return r},t.classicMDSLayout=function(r,n){for(var e=t.getDistanceMatrix(r,n),a=mds.classic(e),i=0;i<r.length;++i)r[i].x=a[i][0],r[i].y=a[i][1],r[i].radius=Math.sqrt(r[i].size/Math.PI);return r},t.lossFunction=function(r,n){for(var e=0,a=0;a<n.length;++a){var i,s=n[a];if(2==s.sets.length){var o=r[s.sets[0]],u=r[s.sets[1]];i=t.circleOverlap(o.radius,u.radius,t.distance(o,u))}else i=t.intersectionArea(s.sets.map(function(t){return r[t]}));e+=(null==s.weight?1:s.weight)*(i-s.size)*(i-s.size)}return e},t.scaleSolution=function(t,r,n,e){var a=function(r){return{max:Math.max.apply(null,t.map(function(t){return t[r]+t.radius})),min:Math.min.apply(null,t.map(function(t){return t[r]-t.radius}))}};r-=2*e,n-=2*e;for(var i=a("x"),s=a("y"),o=Math.min(n/(s.max-s.min),r/(i.max-i.min)),u=(r-(i.max-i.min)*o)/2,c=(n-(s.max-s.min)*o)/2,l=0;l<t.length;++l){var f=t[l];f.radius=o*f.radius,f.x=e+u+(f.x-i.min)*o,f.y=e+c+(f.y-s.min)*o}return t},t.bisect=function(t,r,n,e){var a=(e=e||{}).maxIterations||100,i=e.tolerance||1e-10,s=t(r),o=t(n),u=n-r;if(s*o>0)throw"Initial bisect points must have opposite signs";if(0===s)return r;if(0===o)return n;for(var c=0;c<a;++c){var l=r+(u/=2),f=t(l);if(f*s>=0&&(r=l),Math.abs(u)<i||0===f)return l}return r+u},t.fmin=function(t,r,e){var a=(e=e||{}).maxIterations||200*r.length,i=e.nonZeroDelta||1.1,s=e.zeroDelta||.001,o=e.minErrorDelta||1e-5,u=e.rho||1,c=e.chi||2,l=e.psi||-.5,f=e.sigma||.5,h=e.callback,x=r.length,y=new Array(x+1);y[0]=r,y[0].fx=t(r);for(var d=0;d<x;++d){var g=r.slice();g[d]=g[d]?g[d]*i:s,y[d+1]=g,y[d+1].fx=t(g)}for(var v=function(t,r){return t.fx-r.fx},p=0;p<a&&(y.sort(v),h&&h(y),!(Math.abs(y[0].fx-y[x].fx)<o));++p){var M=new Array(x);for(d=0;d<x;++d){M[d]=0;for(var m=0;m<x;++m)M[d]+=y[m][d];M[d]/=x}var I=y[x],w=n([1+u,M],[-u,I]);w.fx=t(w);var A=w;if(w.fx<=y[0].fx){var z=n([1+c,M],[-c,I]);z.fx=t(z),z.fx<w.fx&&(A=z)}else if(w.fx>=y[x-1].fx){var C,b=!1;if(w.fx<=I.fx?((C=n([1+l,M],[-l,I])).fx=t(C),C.fx<I.fx?A=C:b=!0):((C=n([1-l*u,M],[l*u,I])).fx=t(C),C.fx<=w.fx?A=C:b=!0),b)for(d=1;d<y.length;++d)y[d]=n([1-f,y[0]],[f-1,y[d]]),y[d].fx=t(y[d])}y[x]=A}return y.sort(v),{f:y[0].fx,solution:y[0]}},t.intersectionAreaPath=function(r){var n={};t.intersectionArea(r,n);var e=n.arcs;if(0===e.length)return"M 0 0";for(var a=["\nM",e[0].p2.x,e[0].p2.y],i=0;i<e.length;++i){var s=e[i],o=s.circle.radius;a.push("\nA",o,o,0,s.width>o?1:0,1,s.p1.x,s.p1.y)}return a.join(" ")},t.drawD3Diagram=function(n,a,i,s,o){o=o||{};var u=d3.scale.category10();e(a=t.scaleSolution(a,i,s,"padding"in o?o.padding:6),i,s);var c=n.append("svg").attr("width",i).attr("height",s),l=c.append("g").append("g").selectAll("circle").data(a).enter().append("g"),f=l.append("circle").attr("r",function(t){return t.radius}).style("fill-opacity",.3).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).style("fill",function(t,r){return u(r)}),h=l.append("text").attr("dy",".35em").attr("x",function(t){return Math.floor(t.textCenter.x)}).attr("y",function(t){return Math.floor(t.textCenter.y)}).attr("text-anchor","middle").style("fill",function(t,r){return u(r)}).call(function(t){t.each(r)});return{svg:c,nodes:l,circles:f,text:h}},t.updateD3Diagram=function(n,a,i){var s="padding"in(i=i||{})?i.padding:6,o="duration"in i?i.duration:400,u=n.svg,c=parseInt(u.attr("width"),10),l=parseInt(u.attr("height"),10);e(a=t.scaleSolution(a,c,l,s),c,l);var f=n.nodes.data(a).transition().duration(o);f.select("circle").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return t.radius}),f.select("text").text(function(t){return t.label}).each("end",r).attr("x",function(t){return Math.floor(t.textCenter.x)}).attr("y",function(t){return Math.floor(t.textCenter.y)})},t.intersectionArea=function(r,n){var e,a=function(r){for(var n=[],e=0;e<r.length;++e)for(var a=e+1;a<r.length;++a)for(var i=t.circleCircleIntersection(r[e],r[a]),s=0;s<i.length;++s){var o=i[s];o.parentIndex=[e,a],n.push(o)}return n}(r),i=a.filter(function(n){return t.containedInCircles(n,r)}),s=0,o=0,u=[];if(i.length>1){var c=t.getCenter(i);for(e=0;e<i.length;++e){var l=i[e];l.angle=Math.atan2(l.x-c.x,l.y-c.y)}i.sort(function(t,r){return r.angle-t.angle});var f=i[i.length-1];for(e=0;e<i.length;++e){var h=i[e];o+=(f.x+h.x)*(h.y-f.y);for(var x={x:(h.x+f.x)/2,y:(h.y+f.y)/2},y=null,d=0;d<h.parentIndex.length;++d)if(f.parentIndex.indexOf(h.parentIndex[d])>-1){var g=r[h.parentIndex[d]],v=Math.atan2(h.x-g.x,h.y-g.y),p=Math.atan2(f.x-g.x,f.y-g.y),M=p-v;M<0&&(M+=2*Math.PI);var m=p-M/2,I=t.distance(x,{x:g.x+g.radius*Math.sin(m),y:g.y+g.radius*Math.cos(m)});(null===y||y.width>I)&&(y={circle:g,width:I,p1:h,p2:f})}u.push(y),s+=t.circleArea(y.circle.radius,y.width),f=h}}else{var w=r[0];for(e=1;e<r.length;++e)r[e].radius<w.radius&&(w=r[e]);var A=!1;for(e=0;e<r.length;++e)if(t.distance(r[e],w)>Math.abs(w.radius-r[e].radius)){A=!0;break}A?s=o=0:(s=w.radius*w.radius*Math.PI,u.push({circle:w,p1:{x:w.x,y:w.y+w.radius},p2:{x:w.x-1e-10,y:w.y+w.radius},width:2*w.radius}))}return o/=2,n&&(n.area=s+o,n.arcArea=s,n.polygonArea=o,n.arcs=u,n.innerPoints=i,n.intersectionPoints=a),s+o},t.containedInCircles=function(r,n){for(var e=0;e<n.length;++e)if(t.distance(r,n[e])>n[e].radius+1e-10)return!1;return!0},t.circleIntegral=function(t,r){var n=Math.sqrt(t*t-r*r);return r*n+t*t*Math.atan2(r,n)},t.circleArea=function(r,n){return t.circleIntegral(r,n-r)-t.circleIntegral(r,-r)},t.distance=function(t,r){return Math.sqrt((t.x-r.x)*(t.x-r.x)+(t.y-r.y)*(t.y-r.y))},t.circleOverlap=function(r,n,e){if(e>=r+n)return 0;if(e<=Math.abs(r-n))return Math.PI*Math.min(r,n)*Math.min(r,n);var a=n-(e*e-r*r+n*n)/(2*e);return t.circleArea(r,r-(e*e-n*n+r*r)/(2*e))+t.circleArea(n,a)},t.circleCircleIntersection=function(r,n){var e=t.distance(r,n),a=r.radius,i=n.radius;if(e>=a+i||e<=Math.abs(a-i))return[];var s=(a*a-i*i+e*e)/(2*e),o=Math.sqrt(a*a-s*s),u=r.x+s*(n.x-r.x)/e,c=r.y+s*(n.y-r.y)/e,l=o/e*-(n.y-r.y),f=o/e*-(n.x-r.x);return[{x:u+l,y:c-f},{x:u-l,y:c+f}]},t.getCenter=function(t){for(var r={x:0,y:0},n=0;n<t.length;++n)r.x+=t[n].x,r.y+=t[n].y;return r.x/=t.length,r.y/=t.length,r}}(window.venn=window.venn||{});